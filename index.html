if (settingsList) {
    const row = document.createElement('div');
    row.className = 'settings-row';
    const nameSpan = document.createElement('span');
    nameSpan.className = 'name';
    nameSpan.textContent = cat.name;
    row.appendChild(nameSpan);

    // Always create a limit badge, default to 0 if no limit is set
    const limitBadge = document.createElement('span');
    limitBadge.className = 'limit-badge';
    limitBadge.textContent = `${cat.limit || 0} ₽`; // Display 0 if cat.limit is undefined or 0
    if (cat.limitEnabled && cat.limit > 0) limitBadge.classList.add('active');
    row.appendChild(limitBadge);
    limitBadge.addEventListener('click', (e) => {
        e.stopPropagation();
        let touchTimer = setTimeout(() => {
            let categories = JSON.parse(localStorage.getItem('categories')) || [];
            let value = prompt(`Введите лимит для категории "${cat.name}"`, cat.limit || 0);
            if (value !== null && !isNaN(value)) {
                categories[idx].limit = parseFloat(value);
                localStorage.setItem('categories', JSON.stringify(categories));
                renderCategories();
            }
        }, 200);
        const cancelTouch = () => {
            clearTimeout(touchTimer);
            document.removeEventListener('mouseup', cancelTouch);
            document.removeEventListener('touchend', cancelTouch);
        };
        document.addEventListener('mouseup', cancelTouch);
        document.addEventListener('touchend', cancelTouch);
    });

    const label = document.createElement('label');
    label.className = 'switch';
    const input = document.createElement('input');
    input.type = 'checkbox';
    input.checked = cat.limitEnabled ?? (cat.limit && cat.limit > 0);
    const slider = document.createElement('span');
    slider.className = 'slider';
    label.appendChild(input);
    label.appendChild(slider);
    row.appendChild(label);
    input.addEventListener('change', () => {
        let categories = JSON.parse(localStorage.getItem('categories')) || [];
        categories[idx].limitEnabled = input.checked;
        localStorage.setItem('categories', JSON.stringify(categories));
        const limitBadge = row.querySelector('.limit-badge');
        if (limitBadge) {
            if (input.checked && (cat.limit || 0) > 0) limitBadge.classList.add('active');
            else limitBadge.classList.remove('active');
        }
        calculateWeeklyExpenses();
    });
    settingsList.appendChild(row);
}
