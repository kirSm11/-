<!DOCTYPE html>
<html lang="ru">
<head> 
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¥–µ–Ω—å–ì–∞</title>

  <!-- –î—Ä–µ–≤–Ω–µ—Å–ª–∞–≤—è–Ω—Å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ -->
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">

<style>

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–æ–ø–∫–∏ */
.card-stack-btn {
  position: fixed;
  top: 600px;
  right: 20px;
  width: 100px;
  cursor: pointer;
  perspective: 800px;
  z-index: 999;
  display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞ */
}

.card-stack-btn.expanded {
  z-index: 1001;
}

/* –ö–∞—Ä—Ç–∞ */
.card {
  position: absolute;
  width: 80px;
  height: 50px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  font-weight: bold;
  color: white;
  font-size: 18px;
  transform-origin: top center;
  transition: transform 0.4s cubic-bezier(0.25, 1.5, 0.5, 1), box-shadow 0.4s;
  user-select: none;
}

/* –¶–≤–µ—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∏ –∫–∞—Ä—Ç */
.card[data-bank="–°–±–µ—Ä"] { background-color: #0f9d58; }
.card[data-bank="–Ø–Ω–¥–µ–∫—Å"] { background-color: #ff6eb4; }
.card[data-bank="–¢–∏–Ω—å–∫–æ—Ñ—Ñ"] { background-color: #FFD700; color:#000; }
.card[data-bank="–ê–ª—å—Ñ–∞"] { background-color: #FF0000; }
.card[data-bank="–í–¢–ë"] { background-color: #1E90FF; }
.card[data-bank="–•–∞–ª–≤–∞"] { background-color: #A9A9A9; color:#000; }
.card[data-bank="–£—Ä–∞–ª—Å–∏–±"] { background-color: #800080; }
.card[data-bank="–î—Ä—É–≥–∏–µ"] { background-color: #000000; }

/* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç –≤ —Å–ª–æ–∂–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ */
.card:nth-child(1) { transform: translate(0,0) rotate(-1deg); z-index:1; }
.card:nth-child(2) { transform: translate(4px,2px) rotate(1deg); z-index:2; }
.card:nth-child(3) { transform: translate(8px,4px) rotate(-1deg); z-index:3; }
.card:nth-child(4) { transform: translate(12px,6px) rotate(1deg); z-index:4; }
.card:nth-child(5) { transform: translate(16px,8px) rotate(-1deg); z-index:5; }
.card:nth-child(6) { transform: translate(20px,10px) rotate(1deg); z-index:6; }
.card:nth-child(7) { transform: translate(24px,12px) rotate(-1deg); z-index:7; }
.card:nth-child(8) { transform: translate(28px,14px) rotate(1deg); z-index:8; }

.card .bank-buttons {
  position: absolute;
  left: 110%;       /* —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ */
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  gap: 5px;
  opacity: 0;              /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–≤–∏–¥–∏–º—ã */
  pointer-events: none;     /* –Ω–µ–ª—å–∑—è –∫–ª–∏–∫–Ω—É—Ç—å */
  transition: opacity 0.3s;
}

.card-stack-btn.expanded .card .bank-buttons {
  opacity: 1;               /* —Å—Ç–∞–Ω—É—Ç –≤–∏–¥–∏–º—ã–º–∏ –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ */
  pointer-events: auto;     /* –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã */
}

.bank-buttons button {
  background: none;       /* –±–µ–∑ —Ñ–æ–Ω–∞ */
  border: none;           /* –±–µ–∑ —Ä–∞–º–∫–∏ */
  color: transparent;     /* —Ç–µ–∫—Å—Ç –Ω–µ–≤–∏–¥–∏–º */
  opacity: 0;             /* –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
  width: 40px;            /* –∑–∞–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–∫–∏ */
  height: 40px;
  cursor: pointer;        /* –∫—É—Ä—Å–æ—Ä –∫–∞–∫ —É –æ–±—ã—á–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
  transition: opacity 0.3s, color 0.3s; /* –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ */
}

/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏ –≤ expanded */
.card-stack-btn.expanded .card .bank-buttons button {
  opacity: 1;
  color: #333; /* –∏–ª–∏ inherit, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª –≤–∏–¥–µ–Ω */
}

/* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ */
.card-stack-btn.expanded .card:nth-child(1) { transform: translate(0,0px) rotate(0deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(2) { transform: translate(0,-70px) rotate(-5deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(3) { transform: translate(0,-140px) rotate(3deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(4) { transform: translate(0,-210px) rotate(-3deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(5) { transform: translate(0,-280px) rotate(2deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(6) { transform: translate(0,-350px) rotate(-2deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(7) { transform: translate(0,-420px) rotate(4deg) scale(1.05); }
.card-stack-btn.expanded .card:nth-child(8) { transform: translate(0,-490px) rotate(-4deg) scale(1.05); }

/* –û–≤–µ—Ä–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω */
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.5);
  display: none;
  z-index: 1000;
}

html, body {
    overflow-x: hidden;
    touch-action: pan-y;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background-color: #f2f2f2;

    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}


header {
  background: linear-gradient(145deg, #4CAF50, #2E7D32);
  color: white;
  font-weight: bold;
  text-align: left;
  font-size: 32px;
  padding: 30px 40px;
  margin: 15px;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25),
              inset 0 2px 6px rgba(255,255,255,0.3);
  position: relative;
  overflow: hidden;
  font-family: 'MedievalSharp', cursive;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–µ—Å–∫–∞ */
.shine-container {
  position: absolute;
  top: 28px;      /* –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞ 50px, 80px ‚Äî –æ–ø—É—Å–∫–∞–µ–º –≤–Ω–∏–∑ */
  left: 11%;       
  width: 78%;     
  height: 163px;  /* –ø–æ –≤—ã—Å–æ—Ç–µ —à–∞–ø–∫–∏ –∏–ª–∏ —á—É—Ç—å –±–æ–ª—å—à–µ */
  overflow: hidden; 
  pointer-events: none;
}

/* –°–∞–º–∞ –±–ª–µ—Å—Ç—è—â–∞—è –ø–æ–ª–æ—Å–∫–∞ */
.shine-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: -30%;            /* —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ–ª–æ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
  width: 40%;
  height: 100%;
  background: linear-gradient(
    120deg,
    rgba(255,255,255,0.1) 0%,
    rgba(255,255,255,0.4) 30%,
    rgba(255,255,255,0.1) 60%
  );
  transform: skewX(-25deg);
  animation: shine 10s infinite;
}

@keyframes shine {
  0% {
    left: -120%;   /* —Å—Ç–∞—Ä—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    opacity: 0;    /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è */
  }
  5% {
    opacity: 1;    /* –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–≤–Ω–æ */
  }
  70% {
    left: 100%;    /* –¥–≤–∏–∂–µ–Ω–∏–µ –¥–æ –∫–æ–Ω—Ü–∞ */
    opacity: 0.1;
  }
  100% {
    left: 100%;    /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π */
    opacity: 0;    /* –∏—Å—á–µ–∑–∞–µ—Ç */
  }
}

/* –ò–º–∏—Ç–∞—Ü–∏—è —á–∏–ø–∞ */
header::after {
  content: '';
  position: absolute;
  top: 50px;
  right: 50px;
  width: 40px;
  height: 28px;
  background: linear-gradient(135deg, #d4af37, #f5e29f);
  border-radius: 4px;
  box-shadow: inset 0 0 3px rgba(0,0,0,0.3);
}

/* –ù–∞–∑–≤–∞–Ω–∏–µ –≤ ¬´–∫–∞—Ä—Ç–æ—á–Ω–æ–º¬ª —Å—Ç–∏–ª–µ */
.header-box {
  display: inline-block;
  background: transparent;
  color: #fff;
  font-size: 36px;
  letter-spacing: 1px;
  text-shadow: 0 0 8px rgba(0,0,0,0.4);
}

nav {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
}

nav button {
    padding: 12px 22px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 10px;
    border: 2px solid #0b5ea8;
    background: white;
    color: #4CAF50;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
    z-index: 1; 
}

nav button:hover {
    background: linear-gradient(135deg, #A8E6A2, #45A049);
    color: white;
}

button:hover {
    background-color: #0b7dda;
}

@keyframes spring {
    0% { transform: scale(1); }
    10% { transform: scale(0.7); }
    20% { transform: scale(1.3); }
    30% { transform: scale(0.8); }
    40% { transform: scale(1.2); }
    50% { transform: scale(0.9); }
    60% { transform: scale(1.1); }
    70% { transform: scale(0.95); }
    80% { transform: scale(1.05); }
    90% { transform: scale(0.99); }
    100% { transform: scale(1); }
}

.springing {
    animation: spring 0.95s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

main {
    padding: 20px;
    text-align: center;
}

section {
    display: none;
}

#categoriesList {
    display: block;
    margin-top: 15px;
}

#categoriesList button {
    display: block;
    width: 65%; /* –±—ã–ª–æ 85% ‚Äî —Ç–µ–ø–µ—Ä—å –∫–æ—Ä–æ—á–µ, –≤–∏–∑—É–∞–ª—å–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    margin: 10px 0;
    padding: 16px 20px; /* –≤–µ—Ä–Ω—É–ª–∏ –∫–∞–∫ –±—ã–ª–æ, —á—Ç–æ–±—ã –Ω–µ –∫–∞–∑–∞–ª–∏—Å—å –º–µ–Ω—å—à–µ */
    font-size: 18px;
    font-weight: bold;
    border-radius: 10px;
    position: relative;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    background: linear-gradient(135deg, #5A7DE1, #A0D4FA);
    color: white;
    border: 2px solid #0b5ea8;
    text-align: left;
    margin-left: 20px; /* –ª—ë–≥–∫–∏–π –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—è */
}

#sparkCanvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 1000;
}

.action-modal {
    position: fixed;
    background: rgba(65, 105, 225, 1);
    border-radius: 20px;
    box-shadow: 0 7px 19px rgba(0,0,0,0.25);
    padding: 25px;
    display: flex;
    gap: 10px;
    flex-direction: column;
    animation: fadeIn 0.1s ease-out;
    z-index: 9999;
}

.action-modal button {
    background: linear-gradient(135deg, rgba(244,67,54,1), rgba(255,153,153,1));
    color: white;
    font-weight: bold;
    padding: 20px;
    border-radius: 38px;
    transition: background 0.2s;
}

.action-modal button.rename {
    background: #2196F3;
}

.action-modal button:hover {
    opacity: 0.85;
}

@keyframes fadeIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.rename-container {
    margin-top: 5px;
    display: flex;
    justify-content: center;
}

.rename-container input {
    padding: 5px;
    margin-right: 5px;
    width: 60%;
    max-width: 200px;
}

.rename-container button {
    padding: 5px 10px;
}

.placeholder {
    border: 2px dashed #2196F3;
    margin-bottom: 10px;
    height: 40px;
}

.dragging {
    opacity: 0.7;
    position: absolute;
    z-index: 1000;
    pointer-events: none;
}

#statsCategories {
    margin-top: 10px;
    text-align: left;
    max-width: 600px;
    margin-inline: auto;
}

.stat-item {
    background: #ffffff;
    border: 2px solid #4CAF50;
    border-radius: 10px;
    padding: 10px 14px;
    margin-bottom: 8px;
    font-size: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#settingsSubmenu {
    display: none;
    margin-top: 15px;
    padding: 10px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

#settingsCategories button {
    display: block;
    width: 100%;
    margin-bottom: 8px;
    padding: 8px 12px;
    background: #2196F3;
    color: #fff;
    border: none;
    border-radius: 6px;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s;
}

#settingsCategories button:hover {
    background: #0b7dda;
}

#settings button {
    display: block;
    width: 100%;
    margin-bottom: 10px;
    padding: 10px 15px;
    background: linear-gradient(135deg, #5A7DE1, #A0D4FA);
    color: #fff;
    border: none;
    border-radius: 6px;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s;
}

#settings button:hover {
    background: #0b7dda;
}

.totals-box {
    background: #4CAF50;      /* –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω */
    border-radius: 12px;      /* –æ–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
    padding: 15px;            /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—Å—Ç—É–ø */
    color: white;             /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
    font-weight: bold;        /* –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç */
    text-align: center;       /* –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    margin-top: 15px;         /* –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
    font-size: 18px;          /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ —Ç–µ–∫—Å—Ç */
}


#totalsContainer {
    background: #4CAF50;
    border-radius: 12px;
    padding: 20px;
    color: white;
    font-weight: bold;
    text-align: center;
    margin-top: 20px;
}

#totalsContainer h3 {
    margin-top: 0;
    font-size: 20px;
}

#totalsContainer p {
    margin: 8px 0;
    font-size: 18px;
}

.app-container {
    margin-left: auto;
    margin-right: auto;
    padding-left: 15px;
    padding-right: 15px;
    max-width: 1200px;
    border-left: 5px solid #0b5ea8;
    border-right: 5px solid #0b5ea8;
    box-sizing: border-box;
    background-color: #f2f2f2;
}

@media (max-width: 600px) {
    .app-container {
        padding-left: 8px;
        padding-right: 8px;
        border-left: 2px solid #0b5ea8;
        border-right: 2px solid #0b5ea8;
    }


#clock {
    opacity: 0; /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç */
    background: transparent !important;
    box-shadow: none !important;
    color: transparent !important;
}

/* === iOS —Ç—É–º–±–ª–µ—Ä === */
.switch {
  position: relative;
  display: inline-block;
  width: 46px;
  height: 26px;
  vertical-align: middle;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .3s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .3s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4CAF50;
}
input:checked + .slider:before {
  transform: translateX(20px);
}
}
.limit-badge {
    display: inline-block;
    padding: 4px 10px;
    margin-left: 8px;
    background: #f0f0f0;
    border-radius: 12px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.1);
    font-size: 14px;
    font-weight: bold;
    color: #4CAF50;
    min-width: 50px;
    text-align: center;
    transition: background 0.3s, transform 0.2s;
}

.limit-badge:hover {
    background: #e0ffe0;
    transform: scale(1.05);
}

.limit-badge {
    display: inline-block;
    padding: 4px 10px;
    margin-left: 8px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: bold;
    min-width: 50px;
    text-align: center;
    transition: background 0.3s, transform 0.2s;
    background: #f0f0f0; /* —Å–µ—Ä—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    color: #4CAF50;
}

.limit-badge.active {
    background: #4CAF50;
    color: white;
}
.settings-row {
    display: flex;
    align-items: center;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 8px 12px;
    margin-bottom: 8px;
}

.settings-row .name {
    font-weight: bold;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1; /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–ª–µ–≤–∞ */
}

.limit-badge {
    margin: 0 10px; /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ */
    min-width: 60px;
    text-align: center;
}

.settings-row .switch {
    flex-shrink: 0; /* —Ç—É–º–±–ª–µ—Ä –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}
#background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: white;
  z-index: -1; /* –¥–µ–ª–∞–µ—Ç —Å–ª–æ–π –ø–æ–¥ –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º */
}
/* –§–æ–Ω —É–±–∏—Ä–∞–µ–º —É –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
body, 
.app-container, 
header, 
nav, 
main, 
section, 
#statsCategories, 
#settingsSubmenu, 
#adminSubmenu {
  background: transparent !important;
  box-shadow: none !important;
}

/* –ö–Ω–æ–ø–∫–∏ –∏ –ø–∞–Ω–µ–ª–∏ —Ç–æ–∂–µ –¥–µ–ª–∞–µ–º ¬´–≤–æ–∑–¥—É—à–Ω—ã–º–∏¬ª */
button {
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255,255,255,0.3);
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ç–æ–∂–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
.action-modal {
  background: rgba(255,255,255,0.15) !important;
  backdrop-filter: blur(10px);
  box-shadow: none !important;
}

/* –§–æ–Ω –ø–æ–¥ –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º */
#background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: white; /* –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º */
  z-index: -1;
}


#header-layer header {
  background: linear-gradient(135deg, #E6FFE6, #45A049);
  color: #0b5ea8; /* üîµ —Å–∏–Ω–∏–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  font-weight: bold;
  text-align: center;
  font-size: 42px;
  padding: 25px;
  border-radius: 0 0 12px 12px;
  font-family: 'MedievalSharp', cursive;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}
nav {
  margin-top: 50px; /* —Ä–µ–≥—É–ª–∏—Ä—É–π –ø–æ –≤—ã—Å–æ—Ç–µ —à–∞–ø–∫–∏ */
}
#header-layer {
  position: relative;
  width: 100%;
  z-index: -2;
  overflow: visible; /* —Ç–µ–ø–µ—Ä—å –±–ª–µ—Å–∫ –Ω–µ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å—Å—è */
}


.header-box {
  display: inline-block;
  background: #4CAF50;
  color: white;
  padding: 60px 93px;
  border-radius: 12px;
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 10px #4CAF50, 0 0 20px rgba(11,94,168,0.6);
  font-family: 'MedievalSharp', cursive;
  font-size: 34px;
}
#scrollLayer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 50px; /* –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–ª–∞—à–∫–∏ */
    pointer-events: none; /* –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å —Å–ª–æ–π */
    z-index: 1000000; /* –≤—ã—à–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
}

#scrollBar {
    position: fixed;       /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–∫–Ω–∞ */
    top: 0;                /* —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑ –æ—Ç –≤–µ—Ä—Ö–∞ */
    left: 0;
    width: 100%;
    height: 0;             /* —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ */
    background: linear-gradient(180deg, #4CAF50, #81C784);
    z-index: -1;       /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    pointer-events: none;  /* –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å */
    transition: height 0.1s ease-out;
}
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.5); /* –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π */
  display: none; /* —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  z-index: 1000; /* –≤—ã—à–µ –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ */
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ */
.history-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  z-index: 1001;
  max-width: 90vw;
  max-height: 80vh;
  overflow: auto;
}

.history-modal table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

.history-modal th,
.history-modal td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.history-modal th {
  background-color: #f2f2f2;
  font-weight: bold;
}

.history-modal button {
  padding: 10px 20px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  width: 100%;
}

.history-modal button:hover {
  background: #45a049;
}
</style>
</head>
<body>
<div id="overlay"></div>

<div class="card-stack-btn" id="cardStack">
  <div class="card" data-bank="–°–±–µ—Ä"><span>–°–±–µ—Ä</span><div class="bank-buttons"><button data-bank="–°–±–µ—Ä">–°–±–µ—Ä</button></div></div>
  <div class="card" data-bank="–Ø–Ω–¥–µ–∫—Å"><span>–Ø</span><div class="bank-buttons"><button data-bank="–Ø–Ω–¥–µ–∫—Å">–Ø–Ω–¥–µ–∫—Å</button></div></div>
  <div class="card" data-bank="–¢–∏–Ω—å–∫–æ—Ñ—Ñ"><span>–¢</span><div class="bank-buttons"><button data-bank="–¢–∏–Ω—å–∫–æ—Ñ—Ñ">–¢–∏–Ω—å–∫–æ—Ñ—Ñ</button></div></div>
  <div class="card" data-bank="–ê–ª—å—Ñ–∞"><span>–ê</span><div class="bank-buttons"><button data-bank="–ê–ª—å—Ñ–∞">–ê–ª—å—Ñ–∞</button></div></div>
  <div class="card" data-bank="–í–¢–ë"><span>–í–¢–ë</span><div class="bank-buttons"><button data-bank="–í–¢–ë">–í–¢–ë</button></div></div>
  <div class="card" data-bank="–•–∞–ª–≤–∞"><span>–•–∞–ª–≤–∞</span><div class="bank-buttons"><button data-bank="–•–∞–ª–≤–∞">–•–∞–ª–≤–∞</button></div></div>
  <div class="card" data-bank="–£—Ä–∞–ª—Å–∏–±"><span>–£—Ä–∞–ª</span><div class="bank-buttons"><button data-bank="–£—Ä–∞–ª—Å–∏–±">–£—Ä–∞–ª—Å–∏–±</button></div></div>
  <div class="card" data-bank="–î—Ä—É–≥–∏–µ"><span>–î—Ä—É–≥–∏–µ</span><div class="bank-buttons"><button data-bank="–î—Ä—É–≥–∏–µ">–î—Ä—É–≥–∏–µ</button></div></div>
</div>
  <!-- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π –ø–æ–¥ —à–∞–ø–∫—É -->
<div id="header-layer">
  <header>
    <span class="header-box">–¥—¢–Ω—å–≥–∞</span>
  </header>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–µ—Å–∫–∞ —Ç–µ–ø–µ—Ä—å –≤–Ω–µ header -->
  <div class="shine-container"></div>
</div>

<div id="scrollBar"></div>

  <div class="app-container">
  <nav>
    <button onclick="spring(this); showSection('expenses')">–†–∞—Å—Ö–æ–¥—ã</button>
    <button onclick="spring(this); showSection('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button onclick="spring(this); showSection('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </nav>

  <main>
<section id="expenses">
  <h2>–†–∞—Å—Ö–æ–¥—ã</h2>
  <p></p>

  <button onclick="addCategory(this)">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
  <div id="newCategoryContainer"></div>
  <div id="categoriesList"></div>
</section>

<section id="stats">
  <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
  <p></p>

  <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
  <div id="statsCategories"></div>

<h3>–î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
<canvas id="statsChart" width="400" height="400"></canvas>

<h3>–ò—Ç–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
<div id="totalExpenses" class="totals-box"></div>

<h3>–ò—Ç–æ–≥–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã</h3>
<div id="totalLimits" class="totals-box"></div>

<button onclick="spring(this); showHistory()">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤</button>

</section>

<section id="settings">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  <p></p>

  <button onclick="toggleSubmenu()">–ª–∏–º–∏—Ç—ã</button>

  <div id="settingsSubmenu" style="display: none;">
    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
    <div id="settingsCategories"></div>
  </div>

  <button onclick="toggleAdminSubmenu()">—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</button>

  <div id="adminSubmenu" style="display: none; margin-top: 15px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
    <button onclick="if(confirm('–¢—ã —É–≤–µ—Ä–µ, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å —Å –ª–∏–º–∏—Ç–∞–º–∏ —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å?')) clearLimits();">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–∏–º–∏—Ç—ã</button>
    <button onclick="if(confirm('–¢—ã —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å?')) clearExpenses();">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</button>
  </div>
</section>
</main>

<canvas id="sparkCanvas"></canvas>

<script>

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç (—á—Ç–æ–±—ã –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö)
let cards = [];
const stack = document.getElementById('cardStack');
const overlay = document.getElementById('overlay');
const cardStack = document.getElementById('cardStack');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
function initCards() {
    if (!stack || !overlay) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç—ã stack –∏–ª–∏ overlay –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        return;
    }

    // –ì–µ—Ç—Ç–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (—á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫)
    const getCards = () => Array.from(stack.querySelectorAll('.card'));
    cards = getCards(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

    function moveCardToTop(bankName) {
        const card = cards.find(c => c.dataset.bank === bankName);
        if (!card) return;
        
        stack.appendChild(card);
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ DOM
        cards = [...cards.filter(c => c !== card), card];
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–∞–Ω–∫ –≤ localStorage
        localStorage.setItem('selectedBank', bankName);
        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        initCardListeners();
    }

    function toggleStack() {
        stack.classList.toggle('expanded');
        overlay.style.display = stack.classList.contains('expanded') ? 'block' : 'none';
    }

    stack.addEventListener('click', e => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∂–∞–π—à—É—é –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        if (e.target.closest('button')) return;
        toggleStack();
    });

    overlay.addEventListener('click', () => {
        stack.classList.remove('expanded');
        overlay.style.display = 'none';
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –±–∞–Ω–∫–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º data-bank –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏)
    stack.querySelectorAll('.bank-buttons button').forEach(btn => {
        btn.addEventListener('click', e => {
            e.stopPropagation();
            const bankName = btn.dataset.bank || btn.textContent.trim();
            moveCardToTop(bankName);
            stack.classList.remove('expanded');
            overlay.style.display = 'none';
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º
    function initCardListeners() {
        getCards().forEach(card => {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
            card.removeEventListener('click', handleCardClick);
            card.addEventListener('click', handleCardClick);
        });
    }

    function handleCardClick(e) {
        if (!stack.classList.contains('expanded')) return;
        e.stopPropagation();
        moveCardToTop(this.dataset.bank);
        stack.classList.remove('expanded');
        overlay.style.display = 'none';
    }

    initCardListeners(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
}

// –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
function showSection(id) {
    const sections = document.querySelectorAll('main section');
    sections.forEach(sec => sec.style.display = 'none');
    const targetSection = document.getElementById(id);
    if (targetSection) {
        targetSection.style.display = 'block';
    } else {
        console.warn(`–°–µ–∫—Ü–∏—è —Å id "${id}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Å—Ç–æ–ø–∫–∏ –∫–∞—Ä—Ç
    if (id === 'expenses') {
        cardStack.style.display = 'block';
    } else {
        cardStack.style.display = 'none';
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç–æ–ø–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
        if (cardStack.classList.contains('expanded')) {
            cardStack.classList.remove('expanded');
            overlay.style.display = 'none';
        }
    }
}

function spring(button) {
    if (!button) return;
    button.classList.remove('springing');
    void button.offsetWidth; // –¢—Ä–∏–≥–≥–µ—Ä reflow –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
    button.classList.add('springing');
    if ('vibrate' in navigator) {
        navigator.vibrate(50);
    }
}

/* ================== LocalStorage ================== */
function saveCategory(name) {
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    categories.push({name: name, amount: 0, limit: 0, lastUpdate: null});
    localStorage.setItem('categories', JSON.stringify(categories));
}

function updateCategory(index, newName) {
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    categories[index].name = newName.length > 15 ? newName.slice(0,15) : newName;
    localStorage.setItem('categories', JSON.stringify(categories));
}

function deleteCategory(index) {
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    categories.splice(index, 1);
    localStorage.setItem('categories', JSON.stringify(categories));
}

function addCategory(button) {
    const container = document.getElementById('newCategoryContainer');
    if (!container) {
        console.warn('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä newCategoryContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    container.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞

    // –°–æ–∑–¥–∞—ë–º —Ñ–æ—Ä–º—É –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const form = document.createElement('form');
    form.style.display = 'flex';
    form.style.gap = '10px';
    form.style.marginTop = '10px';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
    input.id = 'newCategoryInput';
    input.required = true;
    input.style.flex = '1';
    input.style.padding = '8px';
    input.maxLength = 15;

    const saveBtn = document.createElement('button');
    saveBtn.type = 'submit';
    saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
    saveBtn.style.padding = '8px 16px';
    saveBtn.onclick = (e) => {
        e.preventDefault();
        const categoryName = input.value.trim();
        if (categoryName) {
            saveCategory(categoryName);
            renderCategories();
            container.innerHTML = ''; // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
        } else {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
        }
    };

    const cancelBtn = document.createElement('button');
    cancelBtn.type = 'button';
    cancelBtn.textContent = '–û—Ç–º–µ–Ω–∞';
    cancelBtn.style.padding = '8px 16px';
    cancelBtn.style.backgroundColor = '#f0f0f0';
    cancelBtn.onclick = () => {
        container.innerHTML = '';
    };

    form.appendChild(input);
    form.appendChild(saveBtn);
    form.appendChild(cancelBtn);
    container.appendChild(form);

    input.focus(); // –§–æ–∫—É—Å –Ω–∞ –∏–Ω–ø—É—Ç –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
}

/* ================== –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å drag & drop ================== */
function renderCategories() {
    const list = document.getElementById('categoriesList');
    const statsList = document.getElementById('statsCategories');
    const settingsList = document.getElementById('settingsCategories'); // –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ (–ø–æ–¥–º–µ–Ω—é)

    list.innerHTML = '';
    if (statsList) statsList.innerHTML = '';
    if (settingsList) settingsList.innerHTML = ''; // —á–∏—Å—Ç–∏–º –ø–æ–¥–º–µ–Ω—é –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π

    let categories = JSON.parse(localStorage.getItem('categories')) || [];

    categories.forEach((cat, idx) => {
        const catBtn = document.createElement('button');
        let displayName = cat.name.length > 15 ? cat.name.slice(0,15) : cat.name;

        catBtn.textContent = displayName;

        let pressTimer;
        let isDragging = false;
        let startY, currentIndex = idx;

        catBtn.addEventListener('mousedown', startPress);
        catBtn.addEventListener('touchstart', startPress, { passive: false });

        catBtn.addEventListener('mouseup', cancelPress);
        catBtn.addEventListener('mouseleave', cancelPress);
        catBtn.addEventListener('touchend', cancelPress);

        function startPress(e) {
            // üö´ –ë–µ–∑ "–Ø–°–¢–†–ï–ë–ê" –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ
            if (!dragEnabled) {
                pressTimer = setTimeout(() => {
                    showActionModal(catBtn, currentIndex);
                }, 1); // –æ–±—ã—á–Ω–æ–µ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
                return;
            }

            if (e.type === 'touchstart') e.preventDefault();
            startY = e.clientY || (e.touches && e.touches[0].clientY);
            isDragging = false;

            pressTimer = setTimeout(() => {
                if (!isDragging) showActionModal(catBtn, currentIndex);
            }, 10);

            function onMove(ev) {
                const moveY = ev.clientY || (ev.touches && ev.touches[0].clientY);
                if (!isDragging && Math.abs(moveY - startY) > 5) {
                    isDragging = true;
                    clearTimeout(pressTimer);
                    removeActionModal();
                    catBtn.classList.add('dragging');
                }
                if (isDragging) {
                    const buttons = Array.from(list.children).filter(b => b.tagName === 'BUTTON');
                    let overIndex = buttons.findIndex(b => {
                        const rect = b.getBoundingClientRect();
                        return moveY > rect.top && moveY < rect.bottom;
                    });
                    if (overIndex !== -1 && overIndex !== currentIndex) {
                        list.insertBefore(catBtn, (overIndex > currentIndex ? buttons[overIndex].nextSibling : buttons[overIndex]));
                        let moved = categories.splice(currentIndex, 1)[0];
                        categories.splice(overIndex, 0, moved);
                        currentIndex = overIndex;
                        localStorage.setItem('categories', JSON.stringify(categories));
                    }
                }
            }

            function endDrag() {
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('touchmove', onMove);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchend', endDrag);
                catBtn.classList.remove('dragging');
                clearTimeout(pressTimer);
            }

            document.addEventListener('mousemove', onMove);
            document.addEventListener('touchmove', onMove, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function cancelPress() {
            clearTimeout(pressTimer);
        }

        list.appendChild(catBtn);

        if (statsList) {
            const statItem = document.createElement('div');
            statItem.className = 'stat-item';
            statItem.style.display = "flex";
            statItem.style.justifyContent = "space-between";
            statItem.style.alignItems = "center";

            // –õ–µ–≤–∞—è —á–∞—Å—Ç—å (–ø–æ—Ç—Ä–∞—á–µ–Ω–æ)
            const left = document.createElement('span');
            left.textContent = `${cat.name}: ${cat.amount.toFixed(2)} ‚ÇΩ`;

            statItem.appendChild(left);

            // –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å (–æ—Å—Ç–∞—Ç–æ–∫)
            if (cat.limit && cat.limit > 0) {
                const right = document.createElement('span');
                let remaining = cat.limit - cat.amount;

                right.textContent = `–û—Å—Ç–∞—Ç–æ–∫: ${remaining.toFixed(2)} ‚ÇΩ`;

                if (remaining < 0) {
                    right.style.color = "red"; // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–µ
                }

                statItem.appendChild(right);
            }

            statsList.appendChild(statItem);
        }

        // === –ö–Ω–æ–ø–∫–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é) ===
        if (settingsList) {
            const row = document.createElement('div');
            row.className = 'settings-row';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'name';
            nameSpan.textContent = cat.name;

            row.appendChild(nameSpan);

            if (cat.limit && cat.limit > 0) {
                const limitBadge = document.createElement('span');
                limitBadge.className = 'limit-badge';
                limitBadge.textContent = `${cat.limit} ‚ÇΩ`;
                if (cat.limitEnabled) limitBadge.classList.add('active');
                row.appendChild(limitBadge);
            }

            const label = document.createElement('label');
            label.className = "switch";
            const input = document.createElement('input');
            input.type = "checkbox";
            input.checked = cat.limitEnabled ?? (cat.limit && cat.limit > 0);
            const slider = document.createElement('span');
            slider.className = "slider";
            label.appendChild(input);
            label.appendChild(slider);
            row.appendChild(label);

            input.addEventListener('change', () => {
                let categories = JSON.parse(localStorage.getItem('categories')) || [];
                categories[idx].limitEnabled = input.checked;
                localStorage.setItem('categories', JSON.stringify(categories));

                const limitBadge = row.querySelector('.limit-badge');
                if (limitBadge) {
                    if (input.checked) limitBadge.classList.add('active');
                    else limitBadge.classList.remove('active');
                }

                calculateWeeklyExpenses();
            });

            row.addEventListener('click', (e) => {
                if (e.target.tagName.toLowerCase() === 'input' || e.target.classList.contains('slider')) return;
                let categories = JSON.parse(localStorage.getItem('categories')) || [];
                let value = prompt(`–í–≤–µ–¥–∏—Ç–µ –ª–∏–º–∏—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${cat.name}"`, cat.limit || 0);
                if (value !== null && !isNaN(value)) {
                    categories[idx].limit = parseFloat(value);
                    localStorage.setItem('categories', JSON.stringify(categories));
                    renderCategories();
                }
            });

            settingsList.appendChild(row);
        }
    });

    // –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
    renderChart(categories);

    // ================== –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã ==================
    let total = categories.reduce((sum, c) => sum + c.amount, 0);
    let totalLimits = categories.reduce((sum, c) => sum + (c.limit || 0), 0);

    const totalContainer = document.getElementById('totalExpenses');
    if (totalContainer) {
        totalContainer.innerHTML = `<p>–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤: ${total.toFixed(2)} ‚ÇΩ</p>
                                    <p id="weeklyExpenses">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: 0 ‚ÇΩ</p>`;
    }

    const weeklyElem = document.getElementById('weeklyExpenses');
    if (weeklyElem) {
        let weeklyTotal = parseFloat(localStorage.getItem('weeklyTotal')) || 0;
        weeklyElem.textContent = `–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: ${weeklyTotal.toFixed(2)} ‚ÇΩ`;
    }

    const totalLimitsContainer = document.getElementById('totalLimits');
    if (totalLimitsContainer) {
        totalLimitsContainer.textContent = `–í—Å–µ–≥–æ –ª–∏–º–∏—Ç–æ–≤: ${totalLimits.toFixed(2)} ‚ÇΩ`;
    }
}

/* =================== –î–∏–∞–≥—Ä–∞–º–º–∞ =================== */
let chartInstance = null;

function renderChart(categories) {
    const ctx = document.getElementById('statsChart');
    if (!ctx) return;

    if (chartInstance) {
        chartInstance.destroy();
    }

    const labels = categories.map(c => c.name);
    const data = categories.map(c => c.amount);

    chartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: [
                    '#FF6384','#36A2EB','#FFCE56',
                    '#4CAF50','#FF9800','#9C27B0',
                    '#00BCD4','#E91E63'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' },
                title: {
                    display: true,
                    text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º'
                }
            }
        }
    });
}

/* =================== –ú–æ–¥–∞–ª–∫–∏ =================== */
let currentModal = null;
let outsideClickHandler = null;
let dragEnabled = false;
let hawkMode = false;

function showActionModal(button, index) {
    removeActionModal();

    const modal = document.createElement('div');
    modal.className = 'action-modal';

    Object.assign(modal.style, {
        position: 'fixed',
        background: '#fff',
        padding: '20px',
        border: '1px solid #000',
        borderRadius: '8px',
        boxShadow: '0 2px 10px rgba(0,0,0,0.3)',
        display: 'flex',
        flexDirection: 'column',
        gap: '10px',
        zIndex: 9999,
        opacity: 0,
        transition: 'opacity 0.2s ease'
    });

    const renameBtn = document.createElement('button');
    renameBtn.textContent = '–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å';
    renameBtn.onclick = (e) => {
        e.stopPropagation();
        removeActionModal();
        showRenameField(button, index);
    };

    const addExpenseBtn = document.createElement('button');
    addExpenseBtn.textContent = '–í–Ω–µ—Å—Ç–∏ —Ä–∞—Å—Ö–æ–¥';
    addExpenseBtn.onclick = (e) => {
        e.stopPropagation();
        removeActionModal();

        let categories = JSON.parse(localStorage.getItem('categories'));
        const category = categories[index];

        let amount = prompt(`–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${category.name}"`, '0');
        if (amount !== null && !isNaN(amount)) {
            amount = parseFloat(amount);

            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–Ω–∫
            const bank = localStorage.getItem('selectedBank') || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

            // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
            const now = new Date();
            const dateStr = now.toLocaleDateString('ru-RU');
            const days = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞'];
            const dayOfWeek = days[now.getDay()];
            const dateISO = now.toISOString();

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ä–∞—Å—Ö–æ–¥–æ–≤
            let history = JSON.parse(localStorage.getItem('expensesHistory')) || [];
            history.push({
                bank: bank,
                dateStr: dateStr,
                dayOfWeek: dayOfWeek,
                amount: amount,
                category: category.name,
                dateISO: dateISO
            });
            localStorage.setItem('expensesHistory', JSON.stringify(history));

            // === –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é ===
            category.amount += amount;
            category.lastUpdate = dateISO;
            categories[index] = category;
            localStorage.setItem('categories', JSON.stringify(categories));

            // === –î–æ–±–∞–≤–ª—è–µ–º –∫ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–º —Ä–∞—Å—Ö–æ–¥–∞–º, –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞ ===
            // === –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º weeklyTotal —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å —Ç—É–º–±–ª–µ—Ä—ã ===
            calculateWeeklyExpenses();

            renderCategories(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        } else {
            alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞');
        }
    };

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
    deleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteCategory(index);
        removeActionModal();
        renderCategories();
    };

    modal.appendChild(renameBtn);
    modal.appendChild(addExpenseBtn);
    modal.appendChild(deleteBtn);

    // === –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ "–Ø–°–¢–†–ï–ë" ===
    const hawkBtn = document.createElement('button');
    hawkBtn.textContent = '–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ü¶Ö';
    hawkBtn.style.background = 'linear-gradient(135deg, #5A7DE1, #A0D4FA)';
    hawkBtn.style.color = 'white';
    hawkBtn.style.fontWeight = 'bold';
    hawkBtn.style.borderRadius = '38px';
    hawkBtn.onclick = (e) => {
        e.stopPropagation();
        removeActionModal(); 
        dragEnabled = true; 
        hawkMode = true;

        // –°–æ–∑–¥–∞—ë–º –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–ª–æ–π –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ
        const blocker = document.createElement('div');
        blocker.id = 'hawkBlocker';
        Object.assign(blocker.style, {
            position: 'fixed',
            top: 0,
            left: 0,
            width: '100%',
            height: '100%',
            background: 'rgba(0,0,0,0.2)',
            zIndex: 99999,
            cursor: 'not-allowed',
            pointerEvents: 'none'
        });
        document.body.appendChild(blocker);

        // === –ö–Ω–æ–ø–∫–∞ "–û–ö" ===
        const exitBtn = document.createElement('button');
        exitBtn.id = 'exitHawkBtn';
        exitBtn.textContent = '–û–ö';
        Object.assign(exitBtn.style, {
            position: 'fixed',
            bottom: '20px',
            right: '20px',
            padding: '15px 25px',
            fontSize: '18px',
            borderRadius: '12px',
            background: 'linear-gradient(135deg, #4CAF50, #81C784)',
            color: 'white',
            fontWeight: 'bold',
            zIndex: 100000
        });
        exitBtn.onclick = () => {
            document.getElementById('hawkBlocker')?.remove();
            exitBtn.remove();
            hawkMode = false;
            dragEnabled = false;
            alert('ü¶Ö –Ø–°–¢–†–ï–ë —É—à—ë–ª –æ—Ç–¥—ã—Ö–∞—Ç—å.');
        };
        document.body.appendChild(exitBtn);

        alert('ü¶Ö –Ø–°–¢–†–ï–ë –≤–∑–ª–µ—Ç–µ–ª! –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
    };

    // ‚¨áÔ∏è –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –º–æ–¥–∞–ª–∫—É (–≤–æ—Ç —ç—Ç–æ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ!)
    modal.appendChild(hawkBtn);

    document.body.appendChild(modal);

    const rect = modal.getBoundingClientRect();
    modal.style.left = `calc(50% - ${rect.width / 2}px)`;
    modal.style.top = `calc(50% - ${rect.height / 2}px)`;

    requestAnimationFrame(() => {
        modal.style.opacity = '1';
    });

    currentModal = modal;
    outsideClickHandler = (e) => {
        if (!modal.contains(e.target)) removeActionModal();
    };
    setTimeout(() => document.addEventListener('click', outsideClickHandler), 0);
}

function removeActionModal() {
    if (currentModal) currentModal.remove();
    currentModal = null;
    if (outsideClickHandler) document.removeEventListener('click', outsideClickHandler);
    outsideClickHandler = null;
}

/* =================== –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ =================== */
function showHistory() {
    const history = JSON.parse(localStorage.getItem('expensesHistory')) || [];
    const sortedHistory = history.sort((a, b) => new Date(b.dateISO) - new Date(a.dateISO));

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    overlay.style.display = 'block';

    // –°–æ–∑–¥–∞—ë–º –º–æ–¥–∞–ª–∫—É
    const modal = document.createElement('div');
    modal.className = 'history-modal';

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    const headerRow = document.createElement('tr');
    ['–ë–∞–Ω–∫', '–î–∞—Ç–∞', '–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏', '–°—É–º–º–∞', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    sortedHistory.forEach(exp => {
        const row = document.createElement('tr');
        [exp.bank, exp.dateStr, exp.dayOfWeek, `${exp.amount.toFixed(2)} ‚ÇΩ`, exp.category].forEach(text => {
            const td = document.createElement('td');
            td.textContent = text;
            row.appendChild(td);
        });
        tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);

    const closeBtn = document.createElement('button');
    closeBtn.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
    closeBtn.onclick = () => {
        overlay.style.display = 'none';
        modal.remove();
    };

    modal.appendChild(table);
    modal.appendChild(closeBtn);
    document.body.appendChild(modal);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
    const overlayHandler = () => {
        overlay.style.display = 'none';
        modal.remove();
        overlay.removeEventListener('click', overlayHandler);
    };
    overlay.addEventListener('click', overlayHandler);
}

function cleanOldExpenses() {
    const history = JSON.parse(localStorage.getItem('expensesHistory')) || [];
    const twelveMonthsAgo = new Date();
    twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);
    const recent = history.filter(exp => new Date(exp.dateISO) >= twelveMonthsAgo);
    localStorage.setItem('expensesHistory', JSON.stringify(recent));
}

/* =================== –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ =================== */
function showRenameField(button, index) {
    const existing = button.parentNode.querySelector('.rename-container');
    if (existing) existing.remove();

    const container = document.createElement('div');
    container.className = 'rename-container';

    const input = document.createElement('input');
    const currentName = JSON.parse(localStorage.getItem('categories'))[index].name;
    input.type = 'text';
    input.value = currentName.length > 15 ? currentName.slice(0,15) : currentName;
    input.maxLength = 15;

    const saveBtn = document.createElement('button');
    saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
    saveBtn.onclick = () => {
        let newName = input.value.trim();
        if (newName.length > 15) newName = newName.slice(0,15);
        if (newName) {
            updateCategory(index, newName);
            renderCategories();
        }
    };

    container.appendChild(input);
    container.appendChild(saveBtn);

    button.parentNode.insertBefore(container, button.nextSibling);
}

// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
function getStartOfWeek() {
    const now = new Date();
    const day = now.getDay(); // 0 = –≤—Å, 1 = –ø–Ω
    const diff = now.getDate() - day + (day === 0 ? -6 : 1); // —Å–º–µ—â–∞–µ–º –∫ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫—É
    const monday = new Date(now.setDate(diff));
    monday.setHours(0,0,0,0);
    return monday;
}

// –°—á–∏—Ç–∞–µ—Ç —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
function calculateWeeklyExpenses() {
    const categories = JSON.parse(localStorage.getItem('categories')) || [];
    const startOfWeek = getStartOfWeek();
    let weeklyTotal = 0;

    categories.forEach(c => {
        // –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞ —á–µ—Ä–µ–∑ —Ç—É–º–±–ª–µ—Ä
        if (c.limitEnabled && c.lastUpdate) {
            const updateDate = new Date(c.lastUpdate);
            if (updateDate >= startOfWeek) {
                weeklyTotal += c.amount;
            }
        }
    });

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
    localStorage.setItem('weeklyTotal', weeklyTotal.toString());

    const weeklyElem = document.getElementById('weeklyExpenses');
    if (weeklyElem) {
        weeklyElem.textContent = `–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: ${weeklyTotal.toFixed(2)} ‚ÇΩ`;
    }
}

/* =================== –ó–∞–≥—Ä—É–∑–∫–∞ =================== */
document.addEventListener('DOMContentLoaded', () => {
    if (!localStorage.getItem('weeklyTotal')) {
        localStorage.setItem('weeklyTotal', '0');
    }

    cleanOldExpenses(); // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
    autoResetMonthlyExpenses();
    autoResetWeeklyExpenses();
    initCards(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—ã
    showSection('expenses');
    renderCategories();

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É
    const savedBank = localStorage.getItem('selectedBank');
    if (savedBank && cards.length > 0) {
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—Ä—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
        setTimeout(() => {
            moveCardToTop(savedBank);
        }, 100);
    }
});

/* ================== –≠—Ñ—Ñ–µ–∫—Ç –∏—Å–∫—Ä ================== */
const canvas = document.getElementById('sparkCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('scroll', () => {
    const scrollTop = window.scrollY || document.documentElement.scrollTop;
    const docHeight = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight) - window.innerHeight;
    const scrollPercent = docHeight > 0 ? scrollTop / docHeight : 0;
    
    const maxHeight = window.innerHeight * 0.4; // –ø–ª–∞—à–∫–∞ —Ä–∞—Å—Ç—ë—Ç –¥–æ —á—É—Ç—å –≤—ã—à–µ —Å–µ—Ä–µ–¥–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞
    const scrollBar = document.getElementById('scrollBar');
    if(scrollBar) {
        scrollBar.style.top = '0'; 
        scrollBar.style.height = `${scrollPercent * maxHeight}px`;
    }
});

let particles = [];
class Particle {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * 2 + 2;
        this.speedX = (Math.random() - 0.5) * 2;
        this.speedY = Math.random() * -2 - 1;
        this.alpha = 1;
        const hue = Math.random() * 30 + 20;
        this.color = `hsl(${hue}, 100%, 50%)`;
    }
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.alpha -= 0.02;
        this.size *= 0.95;
    }
    draw() {
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.size, this.size * 0.3, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
    }
}

const header = document.querySelector('header');
header.addEventListener('pointermove', e => {
    for (let i = 0; i < 3; i++) particles.push(new Particle(e.clientX, e.clientY));
});

function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
        p.update();
        p.draw();
        if (p.alpha <= 0) particles.splice(i, 1);
    });
    requestAnimationFrame(animateParticles);
}
animateParticles();

function toggleSubmenu() {
    const submenu = document.getElementById('settingsSubmenu');
    const adminSubmenu = document.getElementById('adminSubmenu');

    if (submenu.style.display === 'block') {
        submenu.style.display = 'none';
    } else {
        submenu.style.display = 'block';
        if (adminSubmenu) adminSubmenu.style.display = 'none';
    }
}

function toggleAdminSubmenu() {
    const adminSubmenu = document.getElementById('adminSubmenu');
    const submenu = document.getElementById('settingsSubmenu');

    if (adminSubmenu.style.display === 'block') {
        adminSubmenu.style.display = 'none';
    } else {
        adminSubmenu.style.display = 'block';
        if (submenu) submenu.style.display = 'none';
    }
}

function clearLimits() {
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    categories.forEach(c => c.limit = 0);
    localStorage.setItem('categories', JSON.stringify(categories));
    alert("–í—Å–µ –ª–∏–º–∏—Ç—ã —É–¥–∞–ª–µ–Ω—ã");
    renderCategories();
}

function clearExpenses() {
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    categories.forEach(c => c.amount = 0);
    localStorage.setItem('categories', JSON.stringify(categories));
    alert("–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã —É–¥–∞–ª–µ–Ω—ã");
    renderCategories();
}

// === –ß–∞—Å—ã –∏ –¥–∞—Ç–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É ===
function updateClock() {
    const now = new Date();

    // –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏
    const days = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞'];
    const weekday = days[now.getDay()];

    // –î–∞—Ç–∞
    const dateStr = now.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });

    // –í—Ä–µ–º—è
    const timeStr = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

    // –í—ã–≤–æ–¥
    document.getElementById('clock').textContent = `${weekday}, ${dateStr} ${timeStr}`;
}

// –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(updateClock, 1000);
updateClock();

// === –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –º–µ—Å—è—Ü–∞ ===
function autoResetMonthlyExpenses() {
    const today = new Date();
    const currentMonth = today.getMonth(); // 0 = —è–Ω–≤–∞—Ä—å, 11 = –¥–µ–∫–∞–±—Ä—å
    const currentYear = today.getFullYear();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏
    const lastReset = JSON.parse(localStorage.getItem('lastResetMonth'));

    // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è 1-–µ —á–∏—Å–ª–æ –∏ –º–µ—Å—è—Ü+–≥–æ–¥ –¥—Ä—É–≥–æ–π ‚Äî –¥–µ–ª–∞–µ–º —Å–±—Ä–æ—Å
    if (today.getDate() === 1 && (!lastReset || lastReset.month !== currentMonth || lastReset.year !== currentYear)) {
        let categories = JSON.parse(localStorage.getItem('categories')) || [];

        // –û–±–Ω—É–ª—è–µ–º —Ç—Ä–∞—Ç—ã
        categories.forEach(c => c.amount = 0);
        localStorage.setItem('categories', JSON.stringify(categories));

        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –º–µ—Å—è—Ü –∏ –≥–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞
        localStorage.setItem('lastResetMonth', JSON.stringify({month: currentMonth, year: currentYear}));

        alert("–ù–æ–≤—ã–π –º–µ—Å—è—Ü! –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –æ–±–Ω—É–ª–µ–Ω—ã.");
        renderCategories(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    }
}

// === –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ===
function autoResetWeeklyExpenses() {
    const today = new Date();
    const day = today.getDay(); // 0 = –≤—Å, 1 = –ø–Ω

    if (day === 1) { // –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        const mondayDateStr = today.toISOString().slice(0,10); // yyyy-mm-dd
        const lastWeeklyReset = localStorage.getItem('lastWeeklyReset');

        if (lastWeeklyReset !== mondayDateStr) {
            // –û–±–Ω—É–ª—è–µ–º —Ç–æ–ª—å–∫–æ weeklyTotal
            localStorage.setItem('weeklyTotal', '0');
            localStorage.setItem('lastWeeklyReset', mondayDateStr);

            calculateWeeklyExpenses(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        }
    }
}
// –≠—Ñ—Ñ–µ–∫—Ç –∑–µ–ª—ë–Ω–æ–π –ø–ª–∞—à–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
window.addEventListener('scroll', () => {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = docHeight > 0 ? scrollTop / docHeight : 0;
    const maxHeight = 50; // –≤—ã—Å–æ—Ç–∞ –ø–ª–∞—à–∫–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    const scrollBar = document.getElementById('scrollBar');
    if(scrollBar) scrollBar.style.height = `${scrollPercent * maxHeight}px`;
});

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è moveCardToTop (–¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ DOMContentLoaded)
function moveCardToTop(bankName) {
    if (cards.length === 0) return;
    const card = cards.find(c => c.dataset.bank === bankName);
    if (!card) return;
    
    stack.appendChild(card);
    cards = [...cards.filter(c => c !== card), card];
    localStorage.setItem('selectedBank', bankName);
    // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏
    const getCards = () => Array.from(stack.querySelectorAll('.card'));
    getCards().forEach(card => {
        card.removeEventListener('click', handleCardClick);
        card.addEventListener('click', handleCardClick);
    });

    function handleCardClick(e) {
        if (!stack.classList.contains('expanded')) return;
        e.stopPropagation();
        moveCardToTop(this.dataset.bank);
        stack.classList.remove('expanded');
        overlay.style.display = 'none';
    }
}

</script>

</div>

</body>
</html>
```‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã
